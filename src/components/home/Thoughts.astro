---
// src/components/home/Thoughts.astro

import Button from '../layout/Button.astro';
import ThoughtPreview from '../thoughts/ThoughtPreview.astro';
import type { CollectionEntry } from 'astro:content';
import { getCollection } from 'astro:content';

interface Props {
  post?: CollectionEntry<'thoughts'>; // now optional
}

const { post: incoming } = Astro.props as Props;

// If no post is provided, fetch the latest from the collection
let post: CollectionEntry<'thoughts'> | undefined = incoming;
if (!post) {
  const all = await getCollection('thoughts');
  // Sort newest → oldest using pubDate
  all.sort(
    (a, b) =>
      new Date(b.data.pubDate).getTime() - new Date(a.data.pubDate).getTime()
  );
  post = all[0];
}

// Defensive local values (support empty collection)
const hasPost = Boolean(post);
---

<section class="mb-10 px-4 sm:mb-20">
  <div class="mx-auto max-w-2xl lg:max-w-7xl">
    <div class="grid grid-cols-1 items-start gap-y-6 md:grid-cols-12 md:gap-x-6">
      <!-- Heading -->
      <h2 class="col-span-1 font-heading text-4xl font-bold md:col-span-4">My Thoughts</h2>

      <!-- Thought -->
      <div class="col-span-1 md:col-span-8 border-t border-black dark:border-white pt-6 space-y-6">
        {hasPost ? (
          <ThoughtPreview post={post!} />
        ) : (
          <p class="text-lg text-black/60 dark:text-white/60">More essays coming soon.</p>
        )}
        <div class="text-right">
          <Button href="/thoughts" cta="Read More Thoughts →" />
        </div>
      </div>
    </div>
  </div>
</section>
